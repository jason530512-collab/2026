<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>æ¯æ—¥æœˆæ›†æ¡Œå¸ƒ</title>

<link rel="manifest" href="manifest.json">

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
html,body{
  margin:0;height:100%;background:#000;overflow:hidden;
  font-family:-apple-system,BlinkMacSystemFont;
}

/* æ¡Œå¸ƒæ¯”ä¾‹å®¹å™¨ */
.wallpaper{
  width:100vw;height:100vh;
  aspect-ratio:9/19.5;
  max-width:calc(100vh*9/19.5);
  margin:auto;background:#000;
  display:flex;
}

/* ä¸»å…§å®¹ */
.calendar{flex:1;display:flex;flex-direction:column}

/* ä¸ŠåŠéƒ¨ç…§ç‰‡ */
.photo{
  height:50%;background:#222 center/cover no-repeat;position:relative;
}
.photo input{position:absolute;inset:0;opacity:0}
.photoHint{
  position:absolute;right:10px;bottom:10px;
  font-size:10px;color:#fff;
  background:rgba(0,0,0,.5);
  padding:3px 8px;border-radius:6px;
}

/* ä¸­è»¸ */
.center{background:#7f3fbf;color:#fff;text-align:center}
.greeting{padding:12px;font-size:16px}
.monthNav{
  display:flex;justify-content:space-between;
  align-items:center;padding:6px 20px
}
.monthNav button{
  width:34px;height:34px;border-radius:50%;
  border:none;background:#ffd966;font-size:18px
}
.weekdays{
  display:grid;grid-template-columns:repeat(7,1fr);
  font-size:12px;padding-bottom:6px
}

/* ä¸‹åŠéƒ¨æ—¥æœŸ */
.days{
  height:50%;display:grid;
  grid-template-columns:repeat(7,1fr);
  background:rgba(255,255,255,.92);
  backdrop-filter:blur(6px);
}
.day-cell{text-align:center;padding:8px 0}
.solar{font-size:18px;font-weight:600;color:#333}
.lunar{font-size:10px;color:#888}
.weekend .solar{color:#e74c3c}

/* æ¯”ä¾‹åˆ‡æ› */
#ratioSwitch{
  position:fixed;bottom:90px;left:50%;
  transform:translateX(-50%);
  display:flex;gap:10px;z-index:100
}
#ratioSwitch button{
  padding:6px 14px;border-radius:20px;
  border:none;background:#fff;font-size:12px
}

/* å„²å­˜éµ */
#saveBtn{
  position:fixed;bottom:30px;left:50%;
  transform:translateX(-50%);
  padding:12px 30px;border-radius:50px;
  border:none;background:#ffd966;
  font-weight:bold;z-index:100
}

/* çµæœé¡¯ç¤º */
#mask{
  position:fixed;inset:0;background:#000;
  display:none;align-items:center;justify-content:center;
  z-index:999
}
#mask img{width:100%;height:100%;object-fit:contain}

.hide-ui #saveBtn,
.hide-ui .photoHint,
.hide-ui .monthNav button,
.hide-ui #ratioSwitch{visibility:hidden}
</style>
</head>

<body>

<div class="wallpaper" id="wallpaper">
  <div class="calendar" id="calendar">

    <div class="photo" id="photo">
      <input type="file" accept="image/*" id="photoInput">
      <span class="photoHint">é»æ“Šæ›åœ–</span>
    </div>

    <div class="center">
      <div class="greeting" id="quote"></div>
      <div class="monthNav">
        <button onclick="changeMonth(-1)">â—€</button>
        <div id="monthLabel"></div>
        <button onclick="changeMonth(1)">â–¶</button>
      </div>
      <div class="weekdays">
        <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div>
        <div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
      </div>
    </div>

    <div class="days" id="days"></div>
  </div>
</div>

<div id="ratioSwitch">
  <button onclick="setRatio('lock')">é–å±</button>
  <button onclick="setRatio('home')">æ¡Œé¢</button>
</div>

<button id="saveBtn" onclick="capture()">ğŸ“¸ ä¸€éµå„²å­˜æ¡Œå¸ƒ</button>

<div id="mask" onclick="this.style.display='none'">
  <img id="result">
</div>

<script>
let current=new Date();

/* æ¯æ—¥èªéŒ„ */
const quotes=[
  "ä»Šå¤©çš„åŠªåŠ›ï¼Œæœƒæˆç‚ºæ˜å¤©çš„åº•æ°£ã€‚",
  "æ…¢ä¸€é»æ²’é—œä¿‚ï¼Œä½†ä¸è¦åœä¸‹ä¾†ã€‚",
  "æ—¥å­æ™®é€šï¼Œä½†ä½ ä¸æ™®é€šã€‚",
  "å°ˆæ³¨ç•¶ä¸‹ï¼Œå°±æ˜¯æœ€å¥½çš„å®‰æ’ã€‚",
  "æŠŠä»Šå¤©éå¥½ï¼Œå°±æ˜¯æœ€å¤§çš„æˆå°±ã€‚",
  "ç©©ç©©èµ°ï¼Œä¹Ÿæ˜¯ä¸€ç¨®å‰é€²ã€‚"
];
function todayQuote(){
  const day=Math.floor(
    (new Date()-new Date(new Date().getFullYear(),0,0))/86400000
  );
  return quotes[day%quotes.length];
}
quote.innerText=todayQuote();

/* å°ç£å‡æ—¥ */
const holidays={
  "1-1":"å…ƒæ—¦","2-28":"å’Œå¹³ç´€å¿µæ—¥",
  "4-4":"å…’ç«¥ç¯€","4-5":"æ¸…æ˜ç¯€",
  "5-1":"å‹å‹•ç¯€","10-10":"åœ‹æ…¶æ—¥"
};

/* è¾²æ›† */
function lunar(date){
  try{
    const f=new Intl.DateTimeFormat('zh-TW-u-ca-chinese',{day:'numeric',month:'long'});
    const p=f.formatToParts(date);
    const d=p.find(x=>x.type==='day').value;
    const m=p.find(x=>x.type==='month').value;
    return d==="1"?m:d;
  }catch{return""}
}

function render(){
  const y=current.getFullYear(),m=current.getMonth();
  days.innerHTML="";
  monthLabel.innerText=`${y} å¹´ ${m+1} æœˆ`;
  const first=new Date(y,m,1).getDay();
  const total=new Date(y,m+1,0).getDate();
  for(let i=0;i<first;i++)days.appendChild(document.createElement("div"));
  for(let d=1;d<=total;d++){
    const date=new Date(y,m,d);
    let text=lunar(date);
    if(holidays[`${m+1}-${d}`]) text=holidays[`${m+1}-${d}`];
    const cell=document.createElement("div");
    cell.className="day-cell"+([0,6].includes(date.getDay())?" weekend":"");
    cell.innerHTML=`<div class="solar">${d}</div><div class="lunar">${text}</div>`;
    days.appendChild(cell);
  }
}
function changeMonth(n){current.setMonth(current.getMonth()+n);render();}
render();

/* ç…§ç‰‡ */
photoInput.onchange=e=>{
  const r=new FileReader();
  r.onload=()=>photo.style.backgroundImage=`url(${r.result})`;
  r.readAsDataURL(e.target.files[0]);
};

/* æ¯”ä¾‹åˆ‡æ› */
function setRatio(type){
  wallpaper.style.aspectRatio=type==="home"?"9/16":"9/19.5";
}

/* æˆªåœ–å­˜æª” */
async function capture(){
  calendar.classList.add("hide-ui");
  await new Promise(r=>setTimeout(r,300));
  html2canvas(wallpaper,{scale:3,backgroundColor:"#000"}).then(c=>{
    c.toBlob(b=>{
      const f=new File([b],"wallpaper.png",{type:"image/png"});
      if(navigator.canShare&&navigator.canShare({files:[f]})){
        navigator.share({files:[f],title:"æˆ‘çš„æ¡Œå¸ƒ"});
      }else{
        result.src=c.toDataURL();
        mask.style.display="flex";
      }
      calendar.classList.remove("hide-ui");
    });
  });
}
</script>
</body>
</html>
