<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>æ‰‹æ©Ÿå°ˆç”¨å…¨è¢å¹•æœˆæ›†</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
html, body { 
    height: 100%; 
    margin: 0; 
    overflow: hidden; 
    background: #000;
}

body {
    display: flex;
    justify-content: center;
}

/* ä¸»å®¹å™¨ */
.calendar { 
    width: 100vw; 
    height: 100vh;
    max-width: 500px;
    display: flex;
    flex-direction: column;
    background: #000;
    color: #000;
}

/* ğŸ”¹ ä¸ŠåŠéƒ¨ç…§ç‰‡ï¼ˆ50%ï¼‰ */
.photo { 
    height: 50%;
    background: #222 center / cover no-repeat;
    position: relative;
}
.photo input { position: absolute; inset: 0; opacity: 0; }
.photoHint {
    position: absolute;
    bottom: 10px;
    right: 10px;
    font-size: 10px;
    background: rgba(0,0,0,0.5);
    color: #fff;
    padding: 3px 8px;
    border-radius: 5px;
}

/* ğŸ”¹ ä¸­è»¸å€ */
.center {
    background: #7f3fbf;
    color: #fff;
    text-align: center;
}

.greeting {
    padding: 12px;
    font-size: 16px;
}

.monthNav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 20px;
}
.monthNav button {
    font-size: 18px;
    width: 34px;
    height: 34px;
    border-radius: 50%;
    border: none;
    background: #ffd966;
}
#monthLabel { font-weight: bold; }

.weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    font-size: 12px;
    opacity: 0.9;
    padding-bottom: 6px;
}

/* ğŸ”¹ ä¸‹åŠéƒ¨æ—¥æœŸï¼ˆ50%ï¼‰ */
.days {
    height: 50%;
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    background: rgba(255,255,255,0.85);
    backdrop-filter: blur(6px);
    padding-bottom: env(safe-area-inset-bottom);
}

/* æ—¥æœŸæ ¼ */
.day-cell {
    padding: 8px 0;
    text-align: center;
}

/* æ—¥æœŸå­—é«” */
.solar-date {
    font-size: 18px;
    font-weight: 600;
    color: #333;
}
.lunar-date {
    font-size: 10px;
    color: #888;
}

.weekend .solar-date { color: #e05656; }

/* å„²å­˜æŒ‰éˆ• */
#saveBtn {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 30px;
    border-radius: 50px;
    background: #ffd966;
    border: none;
    font-weight: bold;
    z-index: 100;
}

/* æˆªåœ–é®ç½© */
#resultMask {
    position: fixed;
    inset: 0;
    background: #000;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 999;
}
#resultImage {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.hide-ui #saveBtn,
.hide-ui .photoHint,
.hide-ui .monthNav button {
    visibility: hidden;
}
</style>
</head>

<body>

<div class="calendar" id="calendar">

    <div class="photo" id="photoArea">
        <input type="file" id="photoInput" accept="image/*">
        <span class="photoHint">é»æ“Šæ›åœ–</span>
    </div>

    <div class="center">
        <div class="greeting" contenteditable="true">åœ¨é€™è£¡è¼¸å…¥æ‚¨çš„å¿ƒæƒ…...</div>
        <div class="monthNav">
            <button onclick="changeMonth(-1)">â—€</button>
            <div id="monthLabel"></div>
            <button onclick="changeMonth(1)">â–¶</button>
        </div>
        <div class="weekdays">
            <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div>
            <div>å››</div><div>äº”</div><div>å…­</div>
        </div>
    </div>

    <div class="days" id="days"></div>
</div>

<button id="saveBtn" onclick="takeScreenshot()">ğŸ“¸ ç”Ÿæˆæ‰‹æ©Ÿæ¡Œå¸ƒ</button>

<div id="resultMask" onclick="this.style.display='none'">
    <img id="resultImage">
</div>

<script>
let current = new Date();

function getLunarDay(date) {
    try {
        const f = new Intl.DateTimeFormat('zh-TW-u-ca-chinese',{day:'numeric',month:'long'});
        const p = f.formatToParts(date);
        const d = p.find(x=>x.type==='day').value;
        const m = p.find(x=>x.type==='month').value;
        return d === '1' ? m : d;
    } catch { return ''; }
}

function render(){
    const y=current.getFullYear(), m=current.getMonth();
    const days=document.getElementById("days");
    days.innerHTML="";
    monthLabel.innerText=`${y} å¹´ ${m+1} æœˆ`;

    const first=new Date(y,m,1).getDay();
    const total=new Date(y,m+1,0).getDate();

    for(let i=0;i<first;i++) days.appendChild(document.createElement("div"));

    for(let d=1;d<=total;d++){
        const date=new Date(y,m,d);
        const cell=document.createElement("div");
        cell.className="day-cell"+([0,6].includes(date.getDay())?" weekend":"");
        cell.innerHTML=`<div class="solar-date">${d}</div>
                        <div class="lunar-date">${getLunarDay(date)}</div>`;
        days.appendChild(cell);
    }
}

function changeMonth(n){ current.setMonth(current.getMonth()+n); render(); }

photoInput.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>photoArea.style.backgroundImage=`url(${r.result})`;
    r.readAsDataURL(e.target.files[0]);
};

function takeScreenshot(){
    calendar.classList.add('hide-ui');
    setTimeout(()=>{
        html2canvas(calendar,{scale:3,backgroundColor:"#000"}).then(c=>{
            resultImage.src=c.toDataURL();
            resultMask.style.display="flex";
            calendar.classList.remove('hide-ui');
        });
    },300);
}

render();
</script>
</body>
</html>
